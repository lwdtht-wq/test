<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Singapore Religion Data</title>

<!-- D3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<style>
/* ----------------------------------------------------
   GLOBAL THEME: Black-Gold Magical Scroll Edition
---------------------------------------------------- */
body {
    margin: 0;
    background: #0b0b0d;
    color: #f6d98a;
    font-family: "Cinzel", serif;
    overflow-x: hidden;
}

html { scroll-behavior: smooth; }

/* ===========================
   PARALLAX BACKGROUND
=========================== */
.bg-parallax {
    position: fixed;
    inset: 0;
    z-index: -3;
    background: url("https://images.unsplash.com/photo-1526401281623-359c1ac57c46?auto=format&fit=crop&w=1920&q=60")
                center/cover no-repeat;
    filter: brightness(0.25);
}

/* ===========================
   GOLD PARTICLE EFFECT
=========================== */
#particles {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -1;
}

/* ===========================
   MAGIC TITLE
=========================== */
.magic-title {
    text-align: center;
    font-size: 48px;
    margin-top: 80px;
    letter-spacing: 3px;
    color: transparent;
    background: linear-gradient(#f6d98a, #8a6b32);
    -webkit-background-clip: text;
    animation: shimmer 4s infinite linear;
}
@keyframes shimmer {
    0% { text-shadow: 0 0 5px rgba(255,215,130,0.3); }
    50% { text-shadow: 0 0 25px rgba(255,215,130,0.9); }
    100% { text-shadow: 0 0 5px rgba(255,215,130,0.3); }
}

/* ===========================
   SECTION PANEL WITH GLOW
=========================== */
.section {
    padding: 80px 60px;
}

.panel {
    background: rgba(20,20,20,0.65);
    padding: 35px;
    border-radius: 22px;
    border: 1px solid rgba(255,215,130,0.3);
    max-width: 950px;
    margin: auto;
    backdrop-filter: blur(6px);

    opacity: 0;
    transform: scale(0.92);
    animation: glowIn 1.2s forwards ease-out;
}
@keyframes glowIn {
    0% {
        opacity: 0;
        transform: scale(0.92);
        box-shadow: 0 0 0px rgba(255,215,130,0.0);
    }
    100% {
        opacity: 1;
        transform: scale(1);
        box-shadow:
            0 0 18px rgba(255,215,130,0.25),
            inset 0 0 8px rgba(255,200,120,0.25);
    }
}

/* ===========================
      NAVIGATION BAR
=========================== */
nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    background: rgba(15,15,18,0.85);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,215,130,0.25);
    padding: 16px 30px;
    z-index: 1000;
}
nav a {
    color: #f6d98a;
    margin: 0 22px;
    font-size: 17px;
    text-decoration: none;
    transition: 0.3s;
}
nav a:hover {
    text-shadow: 0 0 8px #f6d98a;
    color: #fff4cc;
}
</style>
</head>

<body>

<!-- Background Layers -->
<div class="bg-parallax"></div>
<canvas id="particles"></canvas>

<!-- Navigation -->
<nav>
    <a href="#intro">Home</a>
    <a href="#pie">Religious Composition</a>
    <a href="#trend">Trends</a>
    <a href="#ethnicity">Ethnicity</a>
    <a href="#mapSection">Map</a>
    <a href="#timeline">Timeline</a>
</nav>

<!-- ============================
       HOME SECTION
=============================== -->
<div id="intro" class="section">
    <h1 class="magic-title">Singapore Religion Data</h1>

    <div class="panel">
        <p style="font-size:19px; line-height:1.85;">
            Welcome to the enhanced magical-scroll visualization.
            This webpage explores religion in Singapore using interactive charts,
            animations, geographic mapping, and festival timelines ‚Äî
            wrapped in a mystical black-and-gold theme.
        </p>
    </div>
</div>

<!-- ============================
   GOLD PARTICLE SCRIPT
=============================== -->
<script>
const canvas = document.getElementById("particles");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let particles = [];
for (let i = 0; i < 120; i++) {
    particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 2 + 1,
        d: Math.random() * 0.7 + 0.2
    });
}

function animateParticles() {
    const w = canvas.width;
    const h = canvas.height;

    ctx.clearRect(0,0,w,h);
    ctx.fillStyle = "rgba(246,217,138,0.9)";
    ctx.shadowBlur = 6;
    ctx.shadowColor = "#f6d98a";

    particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        ctx.fill();
        p.y += p.d;
        if (p.y > h) { p.y = -5; p.x = Math.random() * w; }
    });

    requestAnimationFrame(animateParticles);
}
animateParticles();
</script>
<!-- ========================================================= -->
<!-- ====================== PIE CHART ======================== -->
<!-- ========================================================= -->
<div id="pie" class="section">
    <h1 class="magic-title">Religious Composition (2020)</h1>

    <div class="panel">
        <svg id="pieSVG" width="900" height="520"></svg>
        <div class="tooltip" id="pieTip"></div>
    </div>
</div>

<script>
// ----------------------------- DATA -----------------------------
const pieData = [
  {religion:"Buddhism", val:31.1},
  {religion:"Taoism", val:8.8},
  {religion:"Christianity", val:18.9},
  {religion:"Islam", val:15.6},
  {religion:"Hinduism", val:5.0},
  {religion:"Other", val:0.6},
  {religion:"No Religion", val:20.0},
];

// SVG Layout
const PW = 900, PH = 520;
const cx = PW/2, cy = PH/2;
const radius = 160;

const pieSvg = d3.select("#pieSVG");
const pg = pieSvg.append("g")
    .attr("transform", `translate(${cx},${cy})`);

const pieTip = d3.select("#pieTip");

// Colors
const pieColor = d3.scaleOrdinal()
    .domain(pieData.map(d => d.religion))
    .range(["#f6d98a","#d8b46a","#f1cc8f","#c9a35a",
            "#e8c377","#b89349","#ffdf9e"]);

// Generators
const pieGen = d3.pie().value(d => d.val);
const arc = d3.arc().innerRadius(80).outerRadius(radius);
const arcLine = d3.arc().innerRadius(radius + 25).outerRadius(radius + 25);

// ----------------------------- ARC ANIMATION -----------------------------
pg.selectAll("path")
  .data(pieGen(pieData))
  .enter()
  .append("path")
  .attr("fill", d => pieColor(d.data.religion))
  .attr("stroke", "#000")
  .attr("stroke-width", 0.5)
  .attr("opacity", 0)
  .transition()
  .delay((d,i)=> i*180)
  .duration(1100)
  .attr("opacity", 1)
  .attrTween("d", function(d){
      let i = d3.interpolate(
          {startAngle:0, endAngle:0},
          d
      );
      return t => arc(i(t));
  });

// ----------------------------- HOVER INTERACTION -----------------------------
pg.selectAll("path")
  .on("mouseenter", function(event, d){
      d3.select(this)
        .transition().duration(150)
        .attr("transform", "scale(1.06)");

      pieTip.style("opacity", 1)
        .html(`<b>${d.data.religion}</b><br>${d.data.val}%`)
        .style("left", event.clientX + 20 + "px")
        .style("top", event.clientY - 10 + "px");
  })
  .on("mouseleave", function(){
      d3.select(this)
        .transition().duration(150)
        .attr("transform", "scale(1)");

      pieTip.style("opacity", 0);
  });

// ----------------------------- CLICK EXPLODE -----------------------------
pg.selectAll("path")
  .on("click", function(event, d){
      const mid = (d.startAngle + d.endAngle) / 2;
      const dx = Math.cos(mid) * 18;
      const dy = Math.sin(mid) * 18;

      d3.select(this)
        .transition().duration(250)
        .attr("transform", `translate(${dx},${dy})`);
  });

// ----------------------------- NON-OVERLAP LABELS -----------------------------
let labels = pieGen(pieData).map(d => {
    let [lx, ly] = arcLine.centroid(d);
    return {
        ...d,
        side: lx > 0 ? "right" : "left",
        rawX: lx,
        rawY: ly
    };
});

let left = labels.filter(d => d.side === "left")
                  .sort((a,b) => a.rawY - b.rawY);
let right = labels.filter(d => d.side === "right")
                   .sort((a,b) => a.rawY - b.rawY);

// distribute vertically
function distribute(list, minY, maxY) {
    if (list.length === 1) { list[0].finalY = 0; return; }
    const step = (maxY - minY) / (list.length - 1);
    list.forEach((d,i)=> d.finalY = minY + step*i );
}
distribute(left, -180, 180);
distribute(right, -180, 180);

// Merge
labels = [...left, ...right];

// Connecting Lines
pieSvg.append("g")
  .selectAll("polyline")
  .data(labels)
  .enter()
  .append("polyline")
  .attr("stroke", "#f6d98a")
  .attr("stroke-width", 1.3)
  .attr("fill", "none")
  .attr("points", d => {
      const p1 = arc.centroid(d).map((p,i)=> (i? p+cy : p+cx));
      const p2 = arcLine.centroid(d).map((p,i)=> (i? p+cy : p+cx));
      const p3 = [
          d.side === "right" ? cx + 300 : cx - 300,
          cy + d.finalY
      ];
      return [p1, p2, p3];
  });

// Final Text Labels
pieSvg.append("g")
  .selectAll("text")
  .data(labels)
  .enter()
  .append("text")
  .attr("x", d => d.side === "right" ? cx + 320 : cx - 320)
  .attr("y", d => cy + d.finalY + 5)
  .attr("text-anchor", d => d.side === "right" ? "start" : "end")
  .attr("fill", "#f6d98a")
  .attr("font-size", 16)
  .style("opacity", 0)
  .transition()
  .delay((d,i)=> 600 + i*80)
  .duration(500)
  .style("opacity",1)
  .text(d => `${d.data.religion}: ${d.data.val}%`);
</script>
<!-- ========================================================= -->
<!-- ====================== TREND LINES ====================== -->
<!-- ========================================================= -->
<div id="trend" class="section">
    <h1 class="magic-title">Religious Trend (1965‚Äì2020)</h1>

    <div class="panel">
        <svg id="trendSVG" width="720" height="420"></svg>
    </div>
</div>

<script>
/* ------- Trend Data ------- */
const trendData = [
  {year:1965, buddhist:10, christian:5, islam:12},
  {year:1980, buddhist:18, christian:8, islam:14},
  {year:1990, buddhist:24, christian:12, islam:15},
  {year:2000, buddhist:30, christian:17, islam:14},
  {year:2010, buddhist:33, christian:19, islam:15},
  {year:2020, buddhist:31, christian:18.9, islam:15.6}
];

const trendColors = {
  buddhist:"#f6d98a",
  christian:"#d8b46a",
  islam:"#ffdf9e"
};

const tsvg = d3.select("#trendSVG");
const tw = 720, th = 420;
const tm = {top:40,right:100,bottom:40,left:60};

const tx = d3.scaleLinear()
  .domain(d3.extent(trendData, d=>d.year))
  .range([tm.left, tw-tm.right]);

const ty = d3.scaleLinear()
  .domain([0,40])
  .range([th-tm.bottom, tm.top]);

// Axes -------------------------------------------------------
tsvg.append("g")
  .attr("transform",`translate(0,${th-tm.bottom})`)
  .call(d3.axisBottom(tx).tickFormat(d3.format("d")))
  .selectAll("text").attr("fill","#f8d998");

tsvg.append("g")
  .attr("transform",`translate(${tm.left},0)`)
  .call(d3.axisLeft(ty))
  .selectAll("text").attr("fill","#f8d998");

// Tooltip ----------------------------------------------------
const trendTip = d3.select("body")
  .append("div")
  .attr("class","tooltip");

// Draw Lines + Animation -------------------------------------
["buddhist","christian","islam"].forEach(key => {

  const line = d3.line()
      .x(d => tx(d.year))
      .y(d => ty(d[key]));

  const path = tsvg.append("path")
      .datum(trendData)
      .attr("fill","none")
      .attr("stroke", trendColors[key])
      .attr("stroke-width", 2)
      .attr("d",line);

  const length = path.node().getTotalLength();

  // entering animation
  path.attr("stroke-dasharray", length)
      .attr("stroke-dashoffset", length)
      .transition()
      .duration(1800)
      .ease(d3.easeCubic)
      .attr("stroke-dashoffset", 0);

  // Data dots ------------------------------------------------
  const dots = tsvg.append("g")
      .selectAll(`.dot-${key}`)
      .data(trendData)
      .enter()
      .append("circle")
      .attr("class",`dot-${key}`)
      .attr("cx",d=>tx(d.year))
      .attr("cy",d=>ty(d[key]))
      .attr("r",0)
      .attr("fill",trendColors[key])
      .transition()
      .delay((d,i)=> 400 + i*120)
      .duration(500)
      .attr("r",5);

  // Hover effect --------------------------------------------
  tsvg.selectAll(`.dot-${key}`)
    .on("mouseenter", function(e, d){
        d3.select(this)
          .transition().duration(150)
          .attr("r",9)
          .attr("fill","#fff4d0");

        trendTip.html(`<b>${key.toUpperCase()}</b><br>${d[key]}%`)
          .style("left", e.clientX+15+"px")
          .style("top", e.clientY+"px")
          .style("opacity",1);
    })
    .on("mouseleave", function(){
        d3.select(this)
          .transition().duration(150)
          .attr("r",5)
          .attr("fill",trendColors[key]);

        trendTip.style("opacity",0);
    });

  // Legend Interactivity ------------------------------------
  tsvg.append("text")
    .attr("x", tw - tm.right + 20)
    .attr("y", tm.top + ["buddhist","christian","islam"].indexOf(key)*30)
    .attr("fill", trendColors[key])
    .attr("font-size", 16)
    .style("cursor","pointer")
    .text(key.charAt(0).toUpperCase() + key.slice(1))
    .on("click", () => {
        const visible = path.style("opacity") == 1 ? 0 : 1;
        path.transition().duration(600).style("opacity",visible);
        tsvg.selectAll(`.dot-${key}`)
            .transition().duration(600).style("opacity",visible);

        if (visible == 1) {
          path.attr("stroke-dashoffset", length)
              .transition().duration(1500)
              .attr("stroke-dashoffset", 0);
        }
    });
});
</script>
<!-- ========================================================= -->
<!-- ====================== MAP SECTION ====================== -->
<!-- ========================================================= -->
<div id="mapSection" class="section">
    <h1 class="magic-title">Map of Major Religious Sites</h1>

    <div class="panel" style="text-align:center; margin-bottom:25px;">
        <button onclick="loadMarkers(null)">All</button>
        <button onclick="loadMarkers('temple')">Temples</button>
        <button onclick="loadMarkers('mosque')">Mosques</button>
        <button onclick="loadMarkers('church')">Churches</button>
        <button onclick="loadMarkers('hindu')">Hindu Temples</button>
    </div>

    <div class="panel">
        <div id="map"></div>
    </div>
</div>

<script>
// --------------------------------------------------------------
// MAP INITIALISATION
// --------------------------------------------------------------
const map = L.map("map", {scrollWheelZoom:true}).setView([1.3521,103.8198],12);

L.tileLayer(
  'https://tile.jawg.io/jawg-dark/{z}/{x}/{y}.png?access-token=6AvT-Rp7tuT1A5uYWm4y7e8tnHQgDZ1ssqrGh89q7KQfuvZmuJMpqJj0YZqdw2Kc',
{}
).addTo(map);

// Emoji marker styles -----------------------------------------
const iconHTML = {
  temple:"üî±",
  mosque:"üïå",
  church:"‚õ™",
  hindu:"üïâÔ∏è"
};

function createIcon(type){
  return L.divIcon({
    className:"",
    html:`<div style="
      transform: scale(0);
      animation: popIn 0.5s forwards;
      font-size: 32px;">${iconHTML[type]}</div>`
  });
}

// Pop animation
const styleAnim = document.createElement("style");
styleAnim.innerHTML = `
@keyframes popIn {
  0% { transform: scale(0); opacity:0; }
  60% { transform: scale(1.5); opacity:1; }
  100% { transform: scale(1); }
}`;
document.head.appendChild(styleAnim);

// Example religious sites --------------------------------------
const sites = [
    {name:"Buddha Tooth Relic Temple", type:"temple", lat:1.2814, lng:103.8443},
    {name:"Thian Hock Keng", type:"temple", lat:1.2804, lng:103.8480},
    {name:"Sultan Mosque", type:"mosque", lat:1.3028, lng:103.8591},
    {name:"St Andrew‚Äôs Cathedral", type:"church", lat:1.2924, lng:103.8525},
    {name:"Sri Mariamman Temple", type:"hindu", lat:1.2831, lng:103.8447},
    {name:"Sri Veeramakaliamman Temple", type:"hindu", lat:1.3066, lng:103.8497},
];

let markers = [];

function loadMarkers(filter=null){
  markers.forEach(m=>map.removeLayer(m));
  markers = [];

  sites.forEach(s=>{
    if(filter && s.type !== filter) return;

    let marker = L.marker([s.lat,s.lng], {icon:createIcon(s.type)})
      .addTo(map)
      .bindPopup(`<b>${s.name}</b><br>${s.type}`);

    marker.on("mouseover", ()=>marker.openPopup());
    marker.on("mouseout", ()=>marker.closePopup());

    markers.push(marker);
  });
}

loadMarkers();
</script>
<!-- ========================================================= -->
<!-- ====================== TIMELINE SECTION ================= -->
<!-- ========================================================= -->
<div id="timeline" class="section">
    <h1 class="magic-title">Religious Festivals Timeline</h1>

    <div class="panel">
        <svg id="timelineSVG" width="900" height="260"></svg>
    </div>

    <div class="panel">
        <div class="timeline-box"><b>Chinese New Year</b>: Lunar new year celebrations</div>
        <div class="timeline-box"><b>Hari Raya Aidilfitri</b>: End of Ramadan</div>
        <div class="timeline-box"><b>Vesak Day</b>: Buddha‚Äôs birth & enlightenment</div>
        <div class="timeline-box"><b>Deepavali</b>: Festival of Lights</div>
    </div>
</div>

<script>
const festivals = [
  {name:"Chinese New Year", date:"Jan‚ÄìFeb", emoji:"üßß", x:140},
  {name:"Hari Raya", date:"Apr", emoji:"üïå", x:340},
  {name:"Vesak Day", date:"May", emoji:"ü™∑", x:560},
  {name:"Deepavali", date:"Nov", emoji:"ü™î", x:780}
];

const tlSVG = d3.select("#timelineSVG");

// baseline animation ------------------------------------------
tlSVG.append("line")
    .attr("x1",120).attr("x2",120)
    .attr("y1",130).attr("y2",130)
    .attr("stroke","#f6d98a").attr("stroke-width",3)
    .transition().duration(900)
    .attr("x2",840);

// Tooltip
const tlTip = d3.select("body").append("div").attr("class","tooltip");

// Render events ------------------------------------------------
festivals.forEach((f,i)=>{

  // Main filled circle ----------------------------------------
  tlSVG.append("circle")
    .attr("cx", f.x)
    .attr("cy", 130)
    .attr("r", 0)
    .attr("fill","#f6d98a")
    .style("filter","drop-shadow(0 0 8px rgba(255,215,130,1))")
    .transition()
    .delay(300 + i*320)
    .duration(600)
    .attr("r", 14);

  // Interactive halo circle -----------------------------------
  const circle = tlSVG.append("circle")
    .attr("cx", f.x)
    .attr("cy", 130)
    .attr("r", 14)
    .attr("fill","transparent")
    .style("cursor","pointer");

  circle.on("mousemove", function(e){
    d3.select(this)
      .transition().duration(120)
      .attr("r",22);

    tlTip.style("opacity",1)
      .style("left",e.clientX+20+"px")
      .style("top",e.clientY+"px")
      .html(`<b>${f.name}</b><br>${f.date}`);
  });

  circle.on("mouseleave", function(){
    d3.select(this)
      .transition().duration(120)
      .attr("r",14);

    tlTip.style("opacity",0);
  });

  // Labels -----------------------------------------------------
  tlSVG.append("text")
    .attr("x",f.x)
    .attr("y",110)
    .attr("opacity",0)
    .attr("fill","#ffeec2")
    .attr("text-anchor","middle")
    .text(`${f.emoji} ${f.name}`)
    .transition()
    .delay(650 + i*300)
    .duration(600)
    .attr("opacity",1);

  tlSVG.append("text")
    .attr("x",f.x)
    .attr("y",165)
    .attr("opacity",0)
    .attr("fill","#c8a66a")
    .attr("text-anchor","middle")
    .text(f.date)
    .transition()
    .delay(760 + i*300)
    .duration(600)
    .attr("opacity",1);
});
</script>
</body>
</html>
