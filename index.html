<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Singapore Religion Visualization ¬∑ Black & Gold Magical Scroll Edition</title>

<!-- D3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<style>
/* -------------------- GLOBAL STYLE -------------------- */
body {
    margin: 0;
    background: #0d0d0f;
    font-family: "Cinzel", "Georgia", serif;
    color: #f6d98a;
}

html {
  scroll-behavior: smooth;
}

button {
    padding: 10px 16px;
    border-radius: 8px;
    border: 1px solid #f6d98a;
    font-family: inherit;
    background: rgba(255,230,160,0.12);
    color: #f6d98a;
    cursor: pointer;
    margin: 5px;
}
button:hover {
    background: rgba(255,230,160,0.25);
}

/* Title */
h1 {
    text-align: center;
    font-size: 40px;
    letter-spacing: 3px;
    margin: 40px 0 20px;
    text-shadow: 0 0 20px rgba(255,215,130,0.35);
}

.section {
    padding: 60px 60px;
    border-bottom: 1px solid rgba(255,220,150,0.15);
}

.panel {
    background: linear-gradient(145deg,#1a1a1d,#080808);
    border: 1px solid rgba(255,220,150,0.25);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 
        0 0 25px rgba(255,215,130,0.2),
        inset 0 0 8px rgba(255,205,120,0.08);
    margin: 30px auto;
    max-width: 900px;
}

/* -------------------- NAVIGATION -------------------- */
nav {
    position: fixed;
    top: 0; 
    left: 0; 
    right: 0;
    background: rgba(10,10,12,0.9);
    backdrop-filter: blur(10px);
    padding: 12px 20px;
    border-bottom: 1px solid rgba(255,215,130,0.25);
    z-index: 999;
}

nav a {
    color: #f6d98a;
    margin: 0 18px;
    font-size: 16px;
    text-decoration: none;
    transition: 0.25s;
}

nav a:hover {
    color: #fff3c8;
    text-shadow: 0 0 8px #f6d98a;
}

/* Tooltip */
.tooltip {
  position: fixed;
  background: #1a1a1d;
  border: 1px solid #f6d98a;
  padding: 10px 12px;
  border-radius: 10px;
  pointer-events: none;
  color: #f6d98a;
  opacity: 0;
  transition: opacity 0.2s;
}

/* Map */
#map {
  height: 480px;
  border-radius: 15px;
}

/* Timeline */
.timeline-box {
    padding: 12px 20px;
    background: rgba(255,215,130,0.08);
    border: 1px solid rgba(255,215,130,0.25);
    border-radius: 10px;
    margin: 12px 0;
}
</style>
</head>

<body>

<!-- ==================== NAVIGATION ==================== -->
<nav>
    <a href="#intro">Home</a>
    <a href="#pie">Religious Composition</a>
    <a href="#trend">Trends</a>
    <a href="#ethnicity">Ethnic Groups</a>
    <a href="#mapSection">Religious Map</a>
    <a href="#timeline">Festival Timeline</a>
</nav>


<!-- ========================================================= -->
<!-- ====================== HOME ============================= -->
<!-- ========================================================= -->
<div id="intro" class="section">
    <h1>Singapore Religion Data Visualisation<br>Black & Gold Magical Scroll Edition</h1>

    <div class="panel">
        <p style="font-size:18px; line-height:1.8;">
            Welcome to the Singapore Religion Visualization ‚Äî a full interactive experience
            exploring religious composition, long-term trends, ethnic patterns, major worship locations,
            and festival timelines.
            <br><br>
            All visualisations are crafted in a mystical black-and-gold theme, with animations,
            hover highlights, clickable legends, transitions, and dynamic maps.
        </p>
    </div>
</div>


<!-- ========================================================= -->
<!-- ====================== PIE CHART ======================== -->
<!-- ========================================================= -->
<div id="pie" class="section">
    <h1>Religious Composition (2020)</h1>

    <div class="panel">
        <svg id="pieSVG" width="900" height="500"></svg>
        <div class="tooltip" id="pieTip"></div>
    </div>
</div>

<script>
// ----------------------------- DATA -----------------------------
const pieData = [
  {religion:"Buddhism", val:31.1},
  {religion:"Taoism", val:8.8},
  {religion:"Christianity", val:18.9},
  {religion:"Islam", val:15.6},
  {religion:"Hinduism", val:5.0},
  {religion:"Other", val:0.6},
  {religion:"No Religion", val:20.0},
];

// Layout
const PW = 900, PH = 500;
const cx = PW / 2;   // ËÆ©È•ºÂõæÊ∞¥Âπ≥Â±Ö‰∏≠
const cy = PH / 2;   // ÂûÇÁõ¥Â±Ö‰∏≠
const radius = 150;

const pieSvg = d3.select("#pieSVG");
const pg = pieSvg.append("g").attr("transform", `translate(${cx},${cy})`);

const pieTip = d3.select("#pieTip");

// Colors
const pieColor = d3.scaleOrdinal()
  .domain(pieData.map(d=>d.religion))
  .range(["#f6d98a","#d8b46a","#f1cc8f","#c9a35a","#e8c377","#b89349","#ffdf9e"]);

// Generators
const pieGen = d3.pie().value(d => d.val);
const arc = d3.arc().innerRadius(70).outerRadius(radius);
const arcLine = d3.arc().innerRadius(radius+20).outerRadius(radius+20);

// ----------------------------- PIE + ANIMATION -----------------------------
pg.selectAll("path")
  .data(pieGen(pieData))
  .enter()
  .append("path")
  .attr("fill", d => pieColor(d.data.religion))
  .attr("stroke", "#000")
  .attr("stroke-width", 0.4)
  .transition()
  .duration(1200)
  .attrTween("d", function(d){
    let i = d3.interpolate({startAngle:0,endAngle:0}, d);
    return t => arc(i(t));
  });

// ----------------------------- HOVER -----------------------------
pg.selectAll("path")
  .on("mouseenter", function(event, d){
    d3.select(this)
      .transition().duration(150)
      .attr("transform", "scale(1.05)");

    pieTip.style("opacity", 1)
      .html(`<b>${d.data.religion}</b><br>${d.data.val}%`)
      .style("left", event.clientX + 20 + "px")
      .style("top", event.clientY - 10 + "px");
  })
  .on("mouseleave", function(){
    d3.select(this)
      .transition().duration(150)
      .attr("transform", "scale(1)");
    pieTip.style("opacity", 0);
  });

// ----------------------------- CLICK EXPLODE -----------------------------
pg.selectAll("path")
  .on("click", function(event, d){
    const off = 15;
    const mid = (d.startAngle + d.endAngle) / 2;
    const dx = Math.cos(mid) * off;
    const dy = Math.sin(mid) * off;
    d3.select(this)
      .transition().duration(250)
      .attr("transform", `translate(${dx},${dy})`);
  });

// ----------------------------- LABEL LAYOUT (NO OVERLAP) -----------------------------
let labels = pieGen(pieData).map(d=>{
  let [lx, ly] = arcLine.centroid(d);
  const side = lx > 0 ? "right" : "left";
  return {...d, side: side, rawX: lx, rawY: ly};
});

let left = labels.filter(d => d.side === "left");
let right = labels.filter(d => d.side === "right");

left.sort((a,b)=>a.rawY - b.rawY);
right.sort((a,b)=>a.rawY - b.rawY);

function distribute(list, topY, bottomY){
  const gap = (bottomY - topY) / (list.length - 1 || 1);
  list.forEach((d,i)=>{ d.finalY = topY + gap * i; });
}

distribute(left, -160, 160);
distribute(right, -160, 160);

labels = [...left, ...right];

// Polylines
pieSvg.append("g")
  .selectAll("polyline")
  .data(labels)
  .enter()
  .append("polyline")
  .attr("stroke", "#f6d98a")
  .attr("stroke-width", 1.3)
  .attr("fill", "none")
  .attr("points", d => {
    const p1 = arc.centroid(d).map((p,i)=>(i? p+cy : p+cx));
    const p2 = arcLine.centroid(d).map((p,i)=>(i? p+cy : p+cx));
    const p3 = [
      d.side === "right" ? cx + 280 : cx - 280,
      cy + d.finalY
    ];
    return [p1, p2, p3];
  });

// Labels
pieSvg.append("g")
  .selectAll("text")
  .data(labels)
  .enter()
  .append("text")
  .attr("x", d => d.side === "right" ? cx + 300 : cx - 300)
  .attr("y", d => cy + d.finalY + 5)
  .attr("text-anchor", d => d.side === "right" ? "start" : "end")
  .attr("font-size", 15)
  .attr("fill", "#f6d98a")
  .text(d => `${d.data.religion}: ${d.data.val}%`);
</script>


<!-- ========================================================= -->
<!-- ====================== TREND LINES ====================== -->
<!-- ========================================================= -->
<div id="trend" class="section">
    <h1>Religious Trend (1965‚Äì2020)</h1>

    <div class="panel">
        <svg id="trendSVG" width="600" height="400"></svg>
    </div>
</div>

<script>
/* ------- Trend Data ------- */
const trendData = [
  {year:1965, buddhist:10, christian:5, islam:12},
  {year:1980, buddhist:18, christian:8, islam:14},
  {year:1990, buddhist:24, christian:12, islam:15},
  {year:2000, buddhist:30, christian:17, islam:14},
  {year:2010, buddhist:33, christian:19, islam:15},
  {year:2020, buddhist:31, christian:18.9, islam:15.6}
];

const trendColors = {
  buddhist:"#f6d98a",
  christian:"#d8b46a",
  islam:"#ffdf9e"
};

const tsvg = d3.select("#trendSVG");
const tw = 600, th = 400;
const tm = {top:40,right:80,bottom:40,left:50};

const tx = d3.scaleLinear()
  .domain(d3.extent(trendData, d=>d.year))
  .range([tm.left, tw-tm.right]);

const ty = d3.scaleLinear()
  .domain([0,40])
  .range([th-tm.bottom, tm.top]);

tsvg.append("g")
  .attr("transform",`translate(0,${th-tm.bottom})`)
  .call(d3.axisBottom(tx).tickFormat(d3.format("d")))
  .selectAll("text").attr("fill","#f8d998");

tsvg.append("g")
  .attr("transform",`translate(${tm.left},0)`)
  .call(d3.axisLeft(ty))
  .selectAll("text").attr("fill","#f8d998");

const religions = ["buddhist","christian","islam"];

// Tooltip
const trendTip = d3.select("body")
  .append("div")
  .style("position","fixed")
  .style("padding","8px 10px")
  .style("background","#1a1a1d")
  .style("color","#f6d98a")
  .style("border","1px solid #f1d08f")
  .style("border-radius","8px")
  .style("pointer-events","none")
  .style("opacity",0)
  .style("font-size","13px");

function showTrendTip(event,text){
  trendTip.html(text)
    .style("left",(event.clientX+15)+"px")
    .style("top",(event.clientY-10)+"px")
    .transition().duration(100)
    .style("opacity",1);
}
function hideTrendTip(){
  trendTip.transition().duration(150).style("opacity",0);
}

// Draw lines
religions.forEach(key=>{

  const line = d3.line()
      .x(d=>tx(d.year))
      .y(d=>ty(d[key]));

  const path = tsvg.append("path")
      .datum(trendData)
      .attr("fill","none")
      .attr("stroke",trendColors[key])
      .attr("stroke-width",2)
      .attr("d",line);

  const length = path.node().getTotalLength();

  // Animation
  path
    .attr("stroke-dasharray",length)
    .attr("stroke-dashoffset",length)
    .transition()
    .duration(1500)
    .ease(d3.easeCubic)
    .attr("stroke-dashoffset",0);

  // Dots
  const dots = tsvg.selectAll(`.dot-${key}`)
      .data(trendData)
      .enter()
      .append("circle")
      .attr("class",`dot-${key}`)
      .attr("cx",d=>tx(d.year))
      .attr("cy",d=>ty(d[key]))
      .attr("r",4)
      .attr("fill",trendColors[key])
      .style("transition","0.25s");

  dots.on("mouseenter", function(e,d){
      d3.select(this)
        .transition().duration(150)
        .attr("r",7)
        .attr("fill","#fff6dc");

      showTrendTip(e, `${key}: ${d[key]}%`);
  });

  dots.on("mouseleave", function(e,d){
      d3.select(this)
        .transition().duration(150)
        .attr("r",4)
        .attr("fill",trendColors[key]);

      hideTrendTip();
  });

  // Legend
  tsvg.append("text")
      .attr("x", tw-tm.right+10)
      .attr("y", tm.top + religions.indexOf(key)*30)
      .text(key.charAt(0).toUpperCase()+key.slice(1))
      .attr("fill", trendColors[key])
      .style("cursor","pointer")
      .on("click", ()=>{

         const currentOpacity = path.style("opacity") == 1 ? 0 : 1;

         path.transition().duration(600).style("opacity",currentOpacity);
         dots.transition().duration(600).style("opacity",currentOpacity);

         if(currentOpacity==1){
           path
             .attr("stroke-dashoffset",length)
             .transition().duration(1500)
             .attr("stroke-dashoffset",0);
         }
      });
});
</script>


<!-- ========================================================= -->
<!-- ====================== ETHNICITY STACK ================== -->
<!-- ========================================================= -->
<div id="ethnicity" class="section">
    <h1>Ethnicity √ó Religion (Census 2020)</h1>

    <div class="panel">
        <svg id="stackSvg" width="760" height="420"></svg>
        <div class="tooltip" id="stackTip"></div>
    </div>
</div>

<script>
// ------------------------------ DATA ------------------------------
const raceData = [
  {race:"Chinese", Buddhist:33, Christian:20, Islam:1,  Hindu:0.4, None:20},
  {race:"Malay",   Buddhist:1,  Christian:10, Islam:84, Hindu:0.3, None:1},
  {race:"Indian",  Buddhist:5,  Christian:19, Islam:24, Hindu:55,  None:2},
];

const groups = ["Buddhist","Christian","Islam","Hindu","None"];

const colors = {
  Buddhist:"#f6d98a",
  Christian:"#d8b46a",
  Islam:"#ffdf9e",
  Hindu:"#e8c377",
  None:"#c9a35a"
};

// SVG
const svgE = d3.select("#stackSvg");
const EW = 760, EH = 420;
const Em = {top:40, right:40, bottom:40, left:90};

const ex = d3.scaleLinear().domain([0,100]).range([Em.left, EW - Em.right]);
const ey = d3.scaleBand().domain(raceData.map(d => d.race))
      .range([Em.top, EH - Em.bottom]).padding(0.4);

// Axes
svgE.append("g")
  .attr("transform", `translate(0,${EH - Em.bottom})`)
  .call(d3.axisBottom(ex))
  .selectAll("text").attr("fill","#f6d98a");

svgE.append("g")
  .attr("transform", `translate(${Em.left},0)`)
  .call(d3.axisLeft(ey))
  .selectAll("text").attr("fill","#f6d98a");

// Stack
const stackBar = d3.stack().keys(groups);
const layers = stackBar(raceData);

// Tooltip
const tipE = d3.select("#stackTip");

// Draw rect
layers.forEach(layer => {
  svgE.selectAll(`rect.layer-${layer.key}`)
    .data(layer)
    .enter()
    .append("rect")
    .attr("class", `layer-${layer.key}`)
    .attr("x", d => ex(d[0]))
    .attr("y", d => ey(d.data.race))
    .attr("height", ey.bandwidth())
    .attr("width", 0)
    .attr("fill", colors[layer.key])
    .transition()
    .duration(900)
    .attr("width", d => ex(d[1]) - ex(d[0]));
});

// Interaction
svgE.selectAll("rect")
  .on("mouseenter", function(event, d){
    const religion = Object.keys(d.data).find(key =>
      d.data[key] === d[1]-d[0]
    );

    d3.select(this)
      .transition().duration(150)
      .attr("transform", "scale(1.03)");

    tipE.style("opacity",1)
      .html(`<b>${d.data.race}</b><br>${religion}: ${d[1]-d[0]}%`)
      .style("left", event.clientX + 15 + "px")
      .style("top", event.clientY + "px");
  })
  .on("mouseleave", function(){
    d3.select(this)
      .transition().duration(150)
      .attr("transform", "scale(1)");

    tipE.style("opacity",0);
  });

// Legend toggle
groups.forEach((key, i) => {
  svgE.append("text")
    .attr("x", EW - 120)
    .attr("y", Em.top + i*25)
    .attr("fill", colors[key])
    .text(key)
    .style("cursor","pointer")
    .on("click", ()=>{
      const rects = svgE.selectAll(`.layer-${key}`);
      const current = rects.style("opacity") == 1 ? 0 : 1;
      rects.transition().duration(400).style("opacity", current);
    });
});
</script>


<!-- ========================================================= -->
<!-- ====================== MAP SECTION ====================== -->
<!-- ========================================================= -->
<div id="mapSection" class="section">
    <h1>Map of Major Religious Sites</h1>

    <div class="panel" style="text-align:center; margin-bottom:25px;">
        <button onclick="loadMarkers(null)">All</button>
        <button onclick="loadMarkers('temple')">Temples</button>
        <button onclick="loadMarkers('mosque')">Mosques</button>
        <button onclick="loadMarkers('church')">Churches</button>
        <button onclick="loadMarkers('hindu')">Hindu Temples</button>
    </div>

    <div class="panel">
        <div id="map"></div>
    </div>
</div>

<script>
// Map
const map = L.map("map", {scrollWheelZoom:true}).setView([1.3521,103.8198],12);

L.tileLayer(
  'https://tile.jawg.io/jawg-dark/{z}/{x}/{y}.png?access-token=6AvT-Rp7tuT1A5uYWm4y7e8tnHQgDZ1ssqrGh89q7KQfuvZmuJMpqJj0YZqdw2Kc',
{}
).addTo(map);

const iconHTML = {
  temple:"üî±",
  mosque:"üïå",
  church:"‚õ™",
  hindu:"üïâÔ∏è"
};

function createIcon(type){
  return L.divIcon({
    className:"",
    html:`<div style="
      transform: scale(0);
      animation: popIn 0.4s forwards;
      font-size: 30px;">${iconHTML[type]}</div>`
  });
}

// animation effect
const styleAnim = document.createElement("style");
styleAnim.innerHTML = `
@keyframes popIn {
  0% { transform: scale(0); opacity:0; }
  60% { transform: scale(1.5); opacity:1; }
  100% { transform: scale(1); }
}`;
document.head.appendChild(styleAnim);

// Example sites
const sites = [
    {name:"Buddha Tooth Relic Temple", type:"temple", lat:1.2814, lng:103.8443},
    {name:"Thian Hock Keng", type:"temple", lat:1.2804, lng:103.8480},
    {name:"Sultan Mosque", type:"mosque", lat:1.3028, lng:103.8591},
    {name:"St Andrew‚Äôs Cathedral", type:"church", lat:1.2924, lng:103.8525},
    {name:"Sri Mariamman Temple", type:"hindu", lat:1.2831, lng:103.8447},
    {name:"Sri Veeramakaliamman Temple", type:"hindu", lat:1.3066, lng:103.8497},
];

let markers = [];

function loadMarkers(filter=null){
  markers.forEach(m=>map.removeLayer(m));
  markers = [];

  sites.forEach(s=>{
    if(filter && s.type !== filter) return;

    let marker = L.marker([s.lat,s.lng], {icon:createIcon(s.type)})
      .addTo(map)
      .bindPopup(`<b>${s.name}</b><br>${s.type}`);

    marker.on("mouseover", ()=>marker.openPopup());
    marker.on("mouseout", ()=>marker.closePopup());

    markers.push(marker);
  });
}

loadMarkers();
</script>


<!-- ========================================================= -->
<!-- ====================== TIMELINE SECTION ================= -->
<!-- ========================================================= -->
<div id="timeline" class="section">
    <h1>Religious Festivals Timeline</h1>

    <div class="panel">
        <svg id="timelineSVG" width="900" height="260"></svg>
    </div>

    <div class="panel">
        <div class="timeline-box"><b>Chinese New Year</b>: Lunar new year celebrations</div>
        <div class="timeline-box"><b>Hari Raya Aidilfitri</b>: End of Ramadan</div>
        <div class="timeline-box"><b>Vesak Day</b>: Buddha‚Äôs birth & enlightenment</div>
        <div class="timeline-box"><b>Deepavali</b>: Festival of Lights</div>
    </div>
</div>

<script>
const festivals = [
  {name:"Chinese New Year", date:"Jan‚ÄìFeb", emoji:"üßß", x:120},
  {name:"Hari Raya", date:"Apr", emoji:"üïå", x:300},
  {name:"Vesak Day", date:"May", emoji:"ü™∑", x:500},
  {name:"Deepavali", date:"Nov", emoji:"ü™î", x:720}
];

const tlSVG = d3.select("#timelineSVG");

// baseline
tlSVG.append("line")
    .attr("x1",80).attr("x2",80)
    .attr("y1",130).attr("y2",130)
    .attr("stroke","#f6d98a").attr("stroke-width",3)
    .transition().duration(900)
    .attr("x2",820);

// Tooltip
const tlTip = d3.select("body").append("div").attr("class","tooltip");

festivals.forEach((f,i)=>{

  tlSVG.append("circle")
    .attr("cx",f.x)
    .attr("cy",130)
    .attr("r",0)
    .attr("fill","#f6d98a")
    .style("filter","drop-shadow(0 0 6px rgba(255,215,130,1))")
    .transition()
    .delay(300 + i*250)
    .duration(600)
    .attr("r",12);

  const circle = tlSVG.append("circle")
    .attr("cx",f.x)
    .attr("cy",130)
    .attr("r",12)
    .attr("fill","transparent")
    .style("cursor","pointer");

  circle.on("mousemove", function(e){
    d3.select(this)
      .transition().duration(120)
      .attr("r",18);

    tlTip.style("opacity",1)
      .style("left",e.clientX+20+"px")
      .style("top",e.clientY+"px")
      .html(`<b>${f.name}</b><br>${f.date}`);
  });

  circle.on("mouseleave", function(){
    d3.select(this)
      .transition().duration(120)
      .attr("r",12);

    tlTip.style("opacity",0);
  });

  circle.on("click", function(){
    const now = d3.select(this).attr("r");
    const big = now == 12 ? 26 : 12;
    d3.select(this).transition().duration(200).attr("r",big);
  });

  tlSVG.append("text")
    .attr("x",f.x)
    .attr("y",110)
    .attr("opacity",0)
    .attr("fill","#fef2c7")
    .attr("text-anchor","middle")
    .text(`${f.emoji} ${f.name}`)
    .transition()
    .delay(650 + i*250)
    .duration(600)
    .attr("opacity",1);

  tlSVG.append("text")
    .attr("x",f.x)
    .attr("y",160)
    .attr("opacity",0)
    .attr("fill","#c8a66a")
    .attr("text-anchor","middle")
    .text(f.date)
    .transition()
    .delay(750 + i*250)
    .duration(600)
    .attr("opacity",1);
});
</script>

</body>
</html>
